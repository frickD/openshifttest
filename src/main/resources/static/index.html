<!DOCTYPE html>
<html lang="en">
<head>
  <title>VS Industrie</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/all.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="lib/anime/anime.min.js"></script>
</head>
<body>

  <div id="loader" style="    background: #499ca3;background: linear-gradient(51deg, #499ca3 0%, #3ebf95 100%);position: absolute; top: 0; left: 0; height: 100%; width: 100%;">
    <img class="animated zoomIn" src="img/logo.jpg" style=" position: absolute; margin: auto;top: 0;left: 0;right: 0;bottom: 0;max-width:40%; animation-iteration-count: infinite;">
    <!--<i style="color:white; position: absolute; margin: auto;top: 0;left: 0;right: 0;bottom: 0;max-width:40%; animation-iteration-count: infinite;"class="fab fa-raspberry-pi"></i>-->
  </div>


  <div id="app" style="display:none">
  <nav class="navbar navbar-light fixed-top cobee-header">

        <a class="navbar-brand" style="margin-right: 0;" href="index.html">
        <i style="color:white"class="fab fa-raspberry-pi"></i>
      </a>
        <div id="login-button" onclick="location.reload()" class="navbar-login-button"><i class="fas fa-sync-alt" style="color:white"></i></div>
    </nav>

<div id="app-content" style="margin-top:80px">
  <div id="camera-content" style="">
    <div class="container" style="margin-top: 90px;">


      <!--<div class="card">
          <div class="card-header color-background" id="headingColap">
            <h5 class="mb-0">
              <button style="color:white" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseColap" aria-expanded="false" aria-controls="collapseColap">
                Neuen Flieger hinzufügen
              </button>
            </h5>
          </div>
          <div id="collapseColap" class="collapse" aria-labelledby="headingColap" data-parent="#accordion">
            <div id="accordion" class="card-body">
              <div id="aimode"class="" style="">
                <h5 style="margin-top:30px"class="card-title">Scanne ein Flugzeug.</h5>
                <p class="card-text">Scanne mit AI einen Flieger, um die Daten zu erhalten.</p>

                <form onclick="openGallery()" enctype="multipart/form-data" class="text-center">
                  <label class="custom-file-upload">
                    <input id="file_input" name="files" type="file"/>
                    <i style="font-size:70px;" class="fas fa-camera"></i>
                  </label>
                </form>

                <a id="send_btn" onclick="sendIBMVR()" class="btn btn-cobee" style="display: none;width:100%;color:white">Analyse starten</a>
              </div>
              <form style="margin-top:10px">
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="inputEmail4">Hersteller</label>
                    <input type="text" class="form-control" id="manufactor" placeholder="z.B. Airbus">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="inputPassword4">Typ</label>
                    <input type="text" class="form-control" id="modell" placeholder="z.B. A380">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="inputPassword4">Airline</label>
                    <input type="text" class="form-control" id="airline" placeholder="z.B. Lufthansa">
                  </div>
                </div>
                <div class="form-group">
                  <label for="inputAddress">Ort</label>
                  <input type="text" class="form-control" id="place" placeholder="z.B. Flughafen München">
                </div>
                <div class="form-group">
                  <label for="inputAddress">Bild auswählen</label>
                  <input style="display:block!important"type="file" id="myFile" name="filename">
                </div>
              </form>
              <button  onclick="addPlane()" style="width:100%"type="submit" class="btn btn-cobee">Hinzufügen</button>
            </div>

            </div>
          </div>-->

      <div class="card" style="margin-top:20px">
        <div class="card-header color-background">
          Raspberry AI Scan
        </div>
        <div class="card-body text-center">
          <div id="aimode"class="" style="">
            <h5 style="margin-top:30px"class="card-title">Scanne einen Raspberry.</h5>
            <p class="card-text">Scanne mit AI einen Raspberry Pi, um zu erkennen, ob dieser beschädigt ist.</p>

            <form onclick="openGallery()" enctype="multipart/form-data" class="text-center">
              <label class="custom-file-upload">
                <input id="file_input" name="files" type="file"/>
                <i style="font-size:70px;" class="fas fa-camera"></i>
              </label>
            </form>

            <a id="send_btn" onclick="sendIBMVR()" class="btn btn-cobee" style="display: none;width:100%;color:white">Analyse starten</a>
          </div>
          </div>
      </div>



          <!--<div class="card" style="margin-top:20px">
            <div class="card-header color-background">
              Alle Flieger
            </div>
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Ort</th>
                    <th scope="col">Hersteller</th>
                    <th scope="col">Typ</th>
                    <th scope="col">Airline</th>
                    <th scope="col">Bild</th>
                    <th scope="col">Download</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Flughafen Düsseldorf, Germany</td>
                    <td>Airbus</td>
                    <td>A380</td>
                    <td>Emirates</td>
                    <td><img src="img/a380/4.jpeg" style="width:100px" class="img-thumbnail"></td>
                    <td><i class="fas fa-download"></i></td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Macau</td>
                    <td>Airbus</td>
                    <td>A319-132</td>
                    <td>Air Macau</td>
                    <td><img src="img/a319/a319.jpeg" style="width:100px" class="img-thumbnail"></td>
                    <td><i class="fas fa-download"></i></td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Hamburg Airport, Germany</td>
                    <td>Airbus</td>
                    <td>A321</td>
                    <td>Lufthansa</td>
                    <td><img src="img/a321/2.jpeg" style="width:100px" class="img-thumbnail"></td>
                    <td><i class="fas fa-download"></i></td>
                  </tr>
                  <tr id="a320" style="">
                    <th scope="row">4</th>
                    <td id="newPlace">Hamburg Airport, Germany</td>
                    <td id="newManufactor">Airbus</td>
                    <td id="newModel">A320</td>
                    <td id="newAirline">Lufthansa</td>
                    <td><img src="img/a320/1.jpeg" style="width:100px" class="img-thumbnail"></td>
                    <td><i class="fas fa-download"></i></td>
                  </tr>
                </tbody>
              </table>
              </div>
          </div>-->

    </div>
  </div>


  <div class="jumbotron text-center" style="margin-top: 50px;margin-bottom:0;background:#dcdcdc!important"></div>
</div>




<div id="medicament-modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">AI Raspberry Analyse</h5>
      </div>
      <div class="modal-body">
        <div class="card">
          <div class="card-header color-background">
            Auswertung:
          </div>
          <div class="card-body text-center">
            <i id="fine-icon"style="font-size:50px; color:green; margin-bottom:20px"class="fas fa-check-circle"></i>
            <i id="error-icon"style="font-size:50px; color:red; margin-bottom:20px"class="fas fa-exclamation-triangle"></i>
            <div class="text-center">
              <img  id="plane-img" style="width:300px"src=""></img>
            </div>
            <h5 id="plane-title"  style="margin-top:30px"class="card-title"></h5>
            <p id="plane-description"  class="card-text"></p>
          </div>



      </div>
        </div>

      </div>
      <div class="modal-footer" style="background: #3fbc96">
        <button onclick="location.reload()" class="btn btn-secondary" style="background: #489fa2" >Okay</button>
      </div>
    </div>
  </div>
</div>


</div>

</body>
</html>

<script>
window.onload = function() {
      initApp();
};

function initApp() {
  runLoader(false);
}


    function openGallery(){
      $("#send_btn").fadeIn(1000);
    };

    function sendIBMVR(){
      //$("#app").hide();
      //$("#preloader").fadeIn();
      var form = new FormData();
      form.append('images_file', $('input[type=file]')[0].files[0]);
      form.append("classifier_ids", "DefaultCustomModel_1460939724");
      form.append("threshold", 0.6);
      requestAPI(form);
    };

    function runLoader(shouldRun){
     if(shouldRun){
       $("#app").hide();
       $("#loader").fadeIn();
     }else{
       $("#app").fadeIn();
       $("#loader").hide();
     }
    }

    function removePlane(){
      $("#a320").hide();
      $("#a320li").hide();
      $("#a320img").hide();
    }

    function addPlane(){
      $("#a320").fadeIn();
      $("#a320li").fadeIn();
      $("#a320img").fadeIn();
      $("#newModel").text($("#modell").val());
      $("#newPlace").text($("#place").val());
      $("#newAirline").text($("#airline").val());
      $("#newManufactor").text($("#manufactor").val());
    }











//aimode
    function requestAPI(form) {
      runLoader(true);
      var settings = {
        "async": true,
        "crossDomain": true,
        "url": "https://gateway.watsonplatform.net/visual-recognition/api/v3/classify?version=2018-03-19",
        "method": "POST",
        "timeout": 0,
        "headers": {
          "Authorization": "Basic YXBpa2V5OjJrbVFoSFRoLWRRLTNGZHl4UlE3UWFKSm1xN0Q5VjRxSGR6TGhVaUF4OUN5"
        },
        "processData": false,
        "contentType": false,
        "mimeType": "multipart/form-data",
        "data": form
      }
      $.ajax(settings).done(function(response) {



        $("#error-icon").hide();
        $("#fine-icon").hide();
        $("#medicament-modal").modal("show");
        runLoader(false);
        var res = JSON.parse(response);
        console.log(res);
        if (typeof res.images[0].classifiers[0].classes[0].class != "undefined") {
          var classifier = res.images[0].classifiers[0].classes[0].class;
          var probability = Math.round(res.images[0].classifiers[0].classes[0].score * 100);
          if(classifier=="Rasp_Wrong_USB"){
            let prob = 100 - probability.toFixed(2);
            $("#error-icon").fadeIn();
            $("#plane-title").text("Fehler");
            $("#plane-description").text("Ein Fehler wurde entdeckt: Falsche USB-Ports entdeckt");

          }else if (classifier=="Rasp_Wrong_LAN"){
            let prob = 100 - probability.toFixed(2);
            $("#error-icon").fadeIn();
            $("#plane-title").text("Fehler");
            $("#plane-description").text("Ein Fehler wurde entdeckt: Falscher LAN-Port entdeckt");

          }else if (classifier=="Rasp_Wrong_Camera"){
            let prob = 100 - probability.toFixed(2);
            $("#error-icon").fadeIn();
            $("#plane-title").text("Fehler");
            $("#plane-description").text("Ein Fehler wurde entdeckt: Kamera entdeckt");

          }else if (classifier=="Rasp_Correct.zip"){
            let prob = probability.toFixed(2);
            $("#fine-icon").fadeIn();
            $("#plane-title").text("Top");
            $("#plane-description").text("Der Raspberry ist fehlerfrei!");

          }

        }
      }).fail(function(e) {
        runLoader(false);
      });
    }

    $("#file_input").change(function(){
    readURL(this);
});

    function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#plane-img').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}
</script>
